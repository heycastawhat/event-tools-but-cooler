<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="styles.css">
    <script src="theme.js"></script>
    <title>Timer - Event Tools</title>
</head>
<body>
    <div class="container" style="padding: 1rem; max-width: 600px;">
        <header class="flex items-center justify-between mb-4">
            <h1 style="font-size: 1.5rem;">Timer</h1>
            <button class="btn btn-ghost" onclick="window.location.href='index.html'">‚Üê Back</button>
        </header>

        <div class="mode-toggle mb-4">
            <button class="mode-btn active" id="stopwatchMode" onclick="setMode('stopwatch')">Stopwatch</button>
            <button class="mode-btn" id="timerMode" onclick="setMode('timer')">Countdown</button>
        </div>

        <div class="timer-display-container">
            <div class="timer-display" id="display">00:00:00</div>
            <div class="timer-ms" id="displayMs">.000</div>
        </div>

        <div id="timerSetup" class="card mb-4" style="display: none;">
            <h3 class="mb-2" style="font-size: 1rem;">Set Time</h3>
            <div class="time-inputs">
                <div class="time-input-group">
                    <input type="number" id="setHours" value="0" min="0" max="99">
                    <span>hrs</span>
                </div>
                <div class="time-input-group">
                    <input type="number" id="setMinutes" value="5" min="0" max="59">
                    <span>min</span>
                </div>
                <div class="time-input-group">
                    <input type="number" id="setSeconds" value="0" min="0" max="59">
                    <span>sec</span>
                </div>
            </div>
            <div class="preset-buttons mt-4">
                <button class="btn btn-secondary" onclick="setPreset(1)">1 min</button>
                <button class="btn btn-secondary" onclick="setPreset(3)">3 min</button>
                <button class="btn btn-secondary" onclick="setPreset(5)">5 min</button>
                <button class="btn btn-secondary" onclick="setPreset(10)">10 min</button>
            </div>
        </div>

        <div class="controls">
            <button class="control-btn primary" id="startBtn" onclick="startStop()">Start</button>
            <button class="control-btn secondary" id="resetBtn" onclick="reset()">Reset</button>
        </div>

        <div id="lapsContainer" style="display: none;">
            <div class="flex items-center justify-between mb-2 mt-4">
                <h3 style="font-size: 1rem;">Laps</h3>
                <button class="btn btn-ghost" onclick="addLap()">+ Lap</button>
            </div>
            <div id="lapsList" class="laps-list"></div>
        </div>
    </div>

    <style>
        .mode-toggle {
            display: flex;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            padding: 0.25rem;
            gap: 0.25rem;
        }
        
        .mode-btn {
            flex: 1;
            padding: 0.75rem;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-weight: 500;
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .mode-btn.active {
            background: var(--accent);
            color: #fff;
        }
        
        .timer-display-container {
            text-align: center;
            padding: 2rem 1rem;
            margin-bottom: 1rem;
        }
        
        .timer-display {
            font-size: 4rem;
            font-weight: 700;
            font-variant-numeric: tabular-nums;
            color: var(--text-primary);
            line-height: 1;
        }
        
        .timer-ms {
            font-size: 1.5rem;
            color: var(--text-muted);
            font-variant-numeric: tabular-nums;
        }
        
        .timer-display-container.warning .timer-display {
            color: var(--warning);
        }
        
        .timer-display-container.danger .timer-display {
            color: var(--error);
            animation: pulse 0.5s ease-in-out infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 1; }
            to { opacity: 0.5; }
        }
        
        .time-inputs {
            display: flex;
            justify-content: center;
            gap: 1rem;
        }
        
        .time-input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.25rem;
        }
        
        .time-input-group input {
            width: 70px;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            padding: 0.75rem;
        }
        
        .time-input-group span {
            font-size: 0.75rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }
        
        .preset-buttons {
            display: flex;
            gap: 0.5rem;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
        
        .control-btn {
            flex: 1;
            max-width: 150px;
            padding: 1.25rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            border: none;
            border-radius: var(--radius-lg);
            cursor: pointer;
            transition: all var(--transition);
        }
        
        .control-btn.primary {
            background: var(--success);
            color: #fff;
        }
        
        .control-btn.primary.running {
            background: var(--error);
        }
        
        .control-btn.secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            border: 1px solid var(--border);
        }
        
        .control-btn:active {
            transform: scale(0.98);
        }
        
        .laps-list {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .lap-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border);
            border-radius: var(--radius-md);
        }
        
        .lap-number {
            color: var(--text-muted);
            font-size: 0.875rem;
        }
        
        .lap-time {
            font-weight: 600;
            font-variant-numeric: tabular-nums;
        }
        
        .lap-diff {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-variant-numeric: tabular-nums;
        }
    </style>

    <script>
        let mode = 'stopwatch';
        let running = false;
        let startTime = 0;
        let elapsedTime = 0;
        let countdownTime = 0;
        let intervalId = null;
        let laps = [];

        function setMode(newMode) {
            mode = newMode;
            reset();
            
            document.getElementById('stopwatchMode').classList.toggle('active', mode === 'stopwatch');
            document.getElementById('timerMode').classList.toggle('active', mode === 'timer');
            document.getElementById('timerSetup').style.display = mode === 'timer' ? 'block' : 'none';
            document.getElementById('lapsContainer').style.display = mode === 'stopwatch' ? 'block' : 'none';
        }

        function setPreset(minutes) {
            document.getElementById('setHours').value = 0;
            document.getElementById('setMinutes').value = minutes;
            document.getElementById('setSeconds').value = 0;
        }

        function getCountdownMs() {
            const h = parseInt(document.getElementById('setHours').value) || 0;
            const m = parseInt(document.getElementById('setMinutes').value) || 0;
            const s = parseInt(document.getElementById('setSeconds').value) || 0;
            return (h * 3600 + m * 60 + s) * 1000;
        }

        function formatTime(ms) {
            const totalSeconds = Math.floor(ms / 1000);
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;
            
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
        }

        function formatMs(ms) {
            return `.${String(ms % 1000).padStart(3, '0')}`;
        }

        function updateDisplay() {
            const display = document.getElementById('display');
            const displayMs = document.getElementById('displayMs');
            const container = document.querySelector('.timer-display-container');
            
            let displayTime;
            
            if (mode === 'stopwatch') {
                displayTime = elapsedTime;
                container.classList.remove('warning', 'danger');
            } else {
                displayTime = Math.max(0, countdownTime - elapsedTime);
                
                container.classList.remove('warning', 'danger');
                if (displayTime <= 10000 && displayTime > 0) {
                    container.classList.add('danger');
                } else if (displayTime <= 30000) {
                    container.classList.add('warning');
                }
                
                if (displayTime <= 0 && running) {
                    stop();
                    playAlarm();
                }
            }
            
            display.textContent = formatTime(displayTime);
            displayMs.textContent = formatMs(displayTime);
        }

        function tick() {
            elapsedTime = Date.now() - startTime;
            updateDisplay();
        }

        function startStop() {
            if (running) {
                stop();
            } else {
                start();
            }
        }

        function start() {
            if (mode === 'timer') {
                countdownTime = getCountdownMs();
                if (countdownTime <= 0) return;
                document.getElementById('timerSetup').style.display = 'none';
            }
            
            running = true;
            startTime = Date.now() - elapsedTime;
            intervalId = setInterval(tick, 10);
            
            const btn = document.getElementById('startBtn');
            btn.textContent = 'Stop';
            btn.classList.add('running');
            
            if (mode === 'stopwatch') {
                document.getElementById('lapsContainer').style.display = 'block';
            }
        }

        function stop() {
            running = false;
            clearInterval(intervalId);
            
            const btn = document.getElementById('startBtn');
            btn.textContent = 'Start';
            btn.classList.remove('running');
        }

        function reset() {
            stop();
            elapsedTime = 0;
            laps = [];
            updateDisplay();
            renderLaps();
            
            document.querySelector('.timer-display-container').classList.remove('warning', 'danger');
            
            if (mode === 'timer') {
                document.getElementById('timerSetup').style.display = 'block';
            }
        }

        function addLap() {
            if (!running && elapsedTime === 0) return;
            
            const lastLapTime = laps.length > 0 ? laps[0].total : 0;
            laps.unshift({
                total: elapsedTime,
                diff: elapsedTime - lastLapTime
            });
            renderLaps();
        }

        function renderLaps() {
            const container = document.getElementById('lapsList');
            container.innerHTML = laps.map((lap, i) => `
                <div class="lap-item">
                    <span class="lap-number">Lap ${laps.length - i}</span>
                    <span class="lap-diff">+${formatTime(lap.diff)}</span>
                    <span class="lap-time">${formatTime(lap.total)}</span>
                </div>
            `).join('');
        }

        function playAlarm() {
            // Create a loud, attention-grabbing alarm
            const audioContext = new (window.AudioContext || window.webkitAudioContext)();
            
            const frequencies = [880, 1100, 880, 1100, 880, 1100];
            
            frequencies.forEach((freq, i) => {
                setTimeout(() => {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = freq;
                    oscillator.type = 'square';
                    
                    gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
                    gainNode.gain.setValueAtTime(0.5, audioContext.currentTime + 0.15);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.2);
                }, i * 250);
            });
            
            // Vibrate if supported
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200, 100, 200, 100, 200, 100, 200, 100, 200]);
            }
        }

        updateDisplay();
    </script>
</body>
</html>
